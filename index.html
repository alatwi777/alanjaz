<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ملف الإنجاز</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            overflow: hidden;
            touch-action: manipulation;
        }
        
        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        .container {
            text-align: center;
            z-index: 10;
        }
        
        h1 {
            font-size: 6rem;
            margin-bottom: 2rem;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.8);
            transform-style: preserve-3d;
            perspective: 1000px;
            animation: float 3s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0) rotateX(0deg); }
            50% { transform: translateY(-20px) rotateX(5deg); }
        }
        
        .three-d-text {
            display: inline-block;
            color: #fff;
            text-shadow: 
                0 1px 0 #ccc, 
                0 2px 0 #c9c9c9, 
                0 3px 0 #bbb, 
                0 4px 0 #b9b9b9, 
                0 5px 0 #aaa, 
                0 6px 1px rgba(0,0,0,.1), 
                0 0 5px rgba(0,0,0,.1), 
                0 1px 3px rgba(0,0,0,.3), 
                0 3px 5px rgba(0,0,0,.2), 
                0 5px 10px rgba(0,0,0,.25), 
                0 10px 10px rgba(0,0,0,.2), 
                0 20px 20px rgba(0,0,0,.15);
            transform: translateY(-20px) rotateX(30deg);
            animation: threeD 2s ease-in-out infinite alternate;
        }
        
        @keyframes threeD {
            0% { transform: translateY(-20px) rotateX(30deg); }
            100% { transform: translateY(-30px) rotateX(40deg); }
        }
        
        .btn {
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid white;
            color: white;
            padding: 15px 40px;
            font-size: 1.5rem;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
        }
        
        .btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(31, 38, 135, 0.5);
        }
        
        .gallery-page {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 20;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        .upload-btn {
            background: #4CAF50;
            border: none;
            color: white;
            padding: 15px 30px;
            font-size: 1.2rem;
            border-radius: 5px;
            cursor: pointer;
            margin: 20px 0;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .upload-btn:hover {
            background: #45a049;
            transform: scale(1.05);
        }
        
        .slider-container {
            width: 85vw;
            height: 70vh;
            position: relative;
            margin-top: 20px;
            overflow: hidden;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }
        
        .slider {
            width: 100%;
            height: 100%;
            display: flex;
            transition: transform 0.5s ease;
        }
        
        .slide {
            min-width: 100%;
            height: 100%;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
            background: #f5f5f5;
        }
        
        .slide img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }
        
        .slide-delete-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(244, 67, 54, 0.9);
            border: none;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 18px;
            z-index: 25;
            transition: all 0.3s ease;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }
        
        .slide-delete-btn:hover {
            background: rgba(244, 67, 54, 1);
            transform: scale(1.1);
        }
        
        .page-controls {
            display: flex;
            gap: 15px;
            margin-top: 25px;
        }
        
        .control-btn {
            background: rgba(255, 255, 255, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 12px 25px;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            backdrop-filter: blur(5px);
        }
        
        .control-btn:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: translateY(-3px);
        }
        
        .close-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            padding: 12px 17px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.5rem;
            transition: all 0.3s ease;
            z-index: 30;
        }
        
        .close-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: rotate(90deg);
        }
        
        .page-counter {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.5);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 1rem;
            z-index: 25;
        }
        
        .drag-instruction {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.5);
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 10px;
            animation: pulse 2s infinite;
            z-index: 25;
        }
        
        .empty-slide {
            display: flex;
            justify-content: center;
            align-items: center;
            color: #333;
            font-size: 1.5rem;
            text-align: center;
            padding: 20px;
        }
        
        @keyframes pulse {
            0% { opacity: 0.7; }
            50% { opacity: 1; }
            100% { opacity: 0.7; }
        }
        
        .hidden {
            display: none;
        }
        
        #imageUpload {
            display: none;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #4CAF50;
            color: white;
            padding: 15px 25px;
            border-radius: 5px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            transform: translateX(100%);
            transition: transform 0.5s ease;
            z-index: 100;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification.error {
            background: #f44336;
        }
        
        /* تصميم متجاوب */
        @media (max-width: 768px) {
            h1 {
                font-size: 4rem;
            }
            
            .slider-container {
                width: 95vw;
                height: 60vh;
            }
            
            .drag-instruction {
                font-size: 0.9rem;
                padding: 8px 15px;
            }
            
            .control-btn {
                padding: 10px 20px;
                font-size: 0.9rem;
            }
        }
        
        @media (max-width: 480px) {
            h1 {
                font-size: 3rem;
            }
            
            .btn {
                padding: 12px 30px;
                font-size: 1.2rem;
            }
            
            .slider-container {
                height: 50vh;
            }
            
            .page-controls {
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .slide-delete-btn {
                top: 10px;
                right: 10px;
                width: 35px;
                height: 35px;
                font-size: 16px;
            }
        }
    </style>
</head>
<body>
    <!-- الصفحة الرئيسية -->
    <div class="container" id="mainPage">
        <h1><span class="three-d-text">ملف الإنجاز</span></h1>
        <button class="btn" id="browseBtn">تصفح</button>
    </div>

    <!-- صفحة المعرض -->
    <div class="gallery-page" id="galleryPage">
        <button class="close-btn" id="closeBtn">✕</button>
        
        <div class="drag-instruction">
            <i class="fas fa-hand-point-up"></i>
            اسحب لليمين أو لليسار للتنقل بين الصور
        </div>
        
        <label for="imageUpload" class="upload-btn">
            <i class="fas fa-plus"></i>
            إضافة صور
        </label>
        <input type="file" id="imageUpload" accept="image/*" multiple>
        
        <div class="slider-container" id="sliderContainer">
            <div class="slider" id="slider">
                <div class="slide">
                    <div class="empty-slide">
                        <p>لا توجد صور بعد. قم بإضافة بعض الصور لتبدأ.</p>
                    </div>
                </div>
            </div>
            <div class="page-counter" id="pageCounter">0 / 0</div>
        </div>
        
        <div class="page-controls">
            <button class="control-btn" id="rearrangeBtn">
                <i class="fas fa-arrows-alt-v"></i>
                ترتيب الصور
            </button>
        </div>
    </div>

    <!-- إشعار -->
    <div class="notification" id="notification">
        <span id="notificationText"></span>
    </div>

    <!-- عنصر الصوت -->
    <audio id="pageSound" src="data:audio/mpeg;base64,SUQzBAAAAAABEVRYWFgAAAAtAAADY29tbWVudABCaWdTb3VuZEJhbmsuY29tIC8gTGFTb25vdGhlcXVlLm9yZwBURU5DAAAAHQAAA1N3aXRjaCBQbHVzIMKpIE5DSCBTb2Z0d2FyZQBUSVQyAAAABgAAAzIyMzUAVFNTRQAAAA8AAANMYXZmNTcuODMuMTAwAAAAAAAAAAAAAAD/80DEAAAAA0gAAAAATEFNRTMuMTAwVVVVVVVVVVVVVUxBTUUzLjEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/zQsRbAAADSAAAAABVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/zQMSkAAADSAAAAABVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV" preload="auto"></audio>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const browseBtn = document.getElementById('browseBtn');
            const galleryPage = document.getElementById('galleryPage');
            const closeBtn = document.getElementById('closeBtn');
            const imageUpload = document.getElementById('imageUpload');
            const slider = document.getElementById('slider');
            const rearrangeBtn = document.getElementById('rearrangeBtn');
            const pageSound = document.getElementById('pageSound');
            const pageCounter = document.getElementById('pageCounter');
            const sliderContainer = document.getElementById('sliderContainer');
            const notification = document.getElementById('notification');
            const notificationText = document.getElementById('notificationText');
            
            let currentSlide = 0;
            let images = [];
            let startX = 0;
            let startY = 0;
            let isDragging = false;
            let isRearranging = false;
            
            // تحميل الصور المحفوظة من localStorage عند بدء التشغيل
            window.addEventListener('load', function() {
                const savedImages = localStorage.getItem('portfolioImages');
                if (savedImages) {
                    images = JSON.parse(savedImages);
                    if (images.length > 0) {
                        renderSlides();
                        showNotification('تم تحميل الصور المحفوظة مسبقاً');
                    }
                }
            });
            
            // فتح صفحة المعرض
            browseBtn.addEventListener('click', function() {
                galleryPage.style.display = 'flex';
            });
            
            // إغلاق صفحة المعرض
            closeBtn.addEventListener('click', function() {
                galleryPage.style.display = 'none';
                isRearranging = false;
                rearrangeBtn.innerHTML = '<i class="fas fa-arrows-alt-v"></i> ترتيب الصور';
                rearrangeBtn.style.background = 'rgba(255, 255, 255, 0.15)';
            });
            
            // رفع الصور
            imageUpload.addEventListener('change', function(e) {
                const files = e.target.files;
                if (files.length > 0) {
                    processFiles(files);
                }
            });
            
            // معالجة الملفات المرفوعة
            function processFiles(files) {
                let processed = 0;
                
                for (let i = 0; i < files.length; i++) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        images.push({
                            src: e.target.result,
                            id: Date.now() + Math.random().toString(16).slice(2)
                        });
                        
                        processed++;
                        
                        if (processed === files.length) {
                            renderSlides();
                            saveImages();
                            showNotification(`تم إضافة ${files.length} صورة`);
                        }
                    };
                    reader.readAsDataURL(files[i]);
                }
            }
            
            // عرض الشرائح
            function renderSlides() {
                slider.innerHTML = '';
                
                if (images.length === 0) {
                    const emptySlide = document.createElement('div');
                    emptySlide.className = 'slide';
                    emptySlide.innerHTML = '<div class="empty-slide"><p>لا توجد صور بعد. قم بإضافة بعض الصور لتبدأ.</p></div>';
                    slider.appendChild(emptySlide);
                    currentSlide = 0;
                } else {
                    images.forEach((image, index) => {
                        const slide = document.createElement('div');
                        slide.className = 'slide';
                        slide.dataset.id = image.id;
                        
                        const img = document.createElement('img');
                        img.src = image.src;
                        img.draggable = false;
                        slide.appendChild(img);
                        
                        // زر الحذف على كل صورة
                        const deleteBtn = document.createElement('button');
                        deleteBtn.className = 'slide-delete-btn';
                        deleteBtn.innerHTML = '<i class="fas fa-trash"></i>';
                        deleteBtn.onclick = function(e) {
                            e.stopPropagation();
                            deleteImage(image.id);
                        };
                        slide.appendChild(deleteBtn);
                        
                        slider.appendChild(slide);
                    });
                    
                    goToSlide(currentSlide);
                }
                
                updatePageCounter();
            }
            
            // الانتقال إلى شريحة محددة
            function goToSlide(slideIndex) {
                if (images.length === 0) return;
                
                const offset = -slideIndex * 100;
                slider.style.transform = `translateX(${offset}%)`;
                currentSlide = slideIndex;
                updatePageCounter();
                playPageSound();
            }
            
            // تحديث عداد الصفحات
            function updatePageCounter() {
                pageCounter.textContent = `${currentSlide + 1} / ${images.length || 1}`;
            }
            
            // تشغيل صوت تقليب الصفحة
            function playPageSound() {
                pageSound.currentTime = 0;
                pageSound.play().catch(e => console.log("لم يتم تشغيل الصوت بسبب: ", e));
            }
            
            // حفظ الصور في localStorage
            function saveImages() {
                localStorage.setItem('portfolioImages', JSON.stringify(images));
            }
            
            // عرض الإشعار
            function showNotification(message, isError = false) {
                notificationText.textContent = message;
                notification.className = isError ? 'notification error' : 'notification';
                notification.classList.add('show');
                
                setTimeout(() => {
                    notification.classList.remove('show');
                }, 3000);
            }
            
            // حذف صورة
            function deleteImage(imageId) {
                if (images.length === 0) return;
                
                const slideIndex = images.findIndex(img => img.id === imageId);
                if (slideIndex === -1) return;
                
                // تطبيق تأثير الحذف
                const slideElement = slider.children[slideIndex];
                slideElement.style.opacity = '0';
                slideElement.style.transform = 'scale(0.8)';
                
                setTimeout(() => {
                    // حذف الصورة من المصفوفة
                    images = images.filter(img => img.id !== imageId);
                    
                    // حفظ التغييرات وعرض الصور المتبقية
                    saveImages();
                    renderSlides();
                    
                    showNotification('تم حذف الصورة');
                }, 300);
            }
            
            // تبديل وضع إعادة الترتيب
            rearrangeBtn.addEventListener('click', function() {
                isRearranging = !isRearranging;
                
                if (isRearranging) {
                    rearrangeBtn.innerHTML = '<i class="fas fa-check"></i> إنهاء الترتيب';
                    rearrangeBtn.style.background = 'rgba(76, 175, 80, 0.8)';
                    showNotification('اسحب الصور لأعلى أو لأسفل لإعادة ترتيبها');
                } else {
                    rearrangeBtn.innerHTML = '<i class="fas fa-arrows-alt-v"></i> ترتيب الصور';
                    rearrangeBtn.style.background = 'rgba(255, 255, 255, 0.15)';
                    showNotification('تم إنهاء وضع الترتيب');
                }
            });
            
            // إضافة دعم السحب باللمس والفأرة
            sliderContainer.addEventListener('mousedown', handleStart);
            sliderContainer.addEventListener('touchstart', handleStart, { passive: true });
            
            sliderContainer.addEventListener('mousemove', handleMove);
            sliderContainer.addEventListener('touchmove', handleMove, { passive: true });
            
            sliderContainer.addEventListener('mouseup', handleEnd);
            sliderContainer.addEventListener('touchend', handleEnd);
            sliderContainer.addEventListener('mouseleave', handleEnd);
            
            function handleStart(e) {
                if (images.length <= 1) return;
                
                isDragging = true;
                startX = e.clientX || e.touches[0].clientX;
                startY = e.clientY || e.touches[0].clientY;
            }
            
            function handleMove(e) {
                if (!isDragging) return;
                
                const currentX = e.clientX || e.touches[0].clientX;
                const currentY = e.clientY || e.touches[0].clientY;
                
                const diffX = currentX - startX;
                const diffY = currentY - startY;
                
                // إذا كنا في وضع إعادة الترتيب
                if (isRearranging && Math.abs(diffY) > Math.abs(diffX)) {
                    e.preventDefault();
                    const slideElement = slider.children[currentSlide];
                    slideElement.style.transform = `translateY(${diffY}px)`;
                }
            }
            
            function handleEnd(e) {
                if (!isDragging) return;
                
                isDragging = false;
                const endX = e.clientX || (e.changedTouches ? e.changedTouches[0].clientX : 0);
                const endY = e.clientY || (e.changedTouches ? e.changedTouches[0].clientY : 0);
                
                const diffX = endX - startX;
                const diffY = endY - startY;
                
                // إعادة تعيين تحويل الشريحة
                const slideElement = slider.children[currentSlide];
                slideElement.style.transform = '';
                
                // تحديد اتجاه السحب والقوة
                const absDiffX = Math.abs(diffX);
                const absDiffY = Math.abs(diffY);
                
                if (absDiffX < 20 && absDiffY < 20) return; // تجاهل السحب الصغير
                
                // إذا كنا في وضع إعادة الترتيب
                if (isRearranging && absDiffY > absDiffX) {
                    if (diffY < -50 && currentSlide > 0) {
                        // نقل الصورة للأعلى (لليسار في الترتيب)
                        moveImageUp(currentSlide);
                    } else if (diffY > 50 && currentSlide < images.length - 1) {
                        // نقل الصورة للأسفل (لليمين في الترتيب)
                        moveImageDown(currentSlide);
                    }
                    return;
                }
                
                // التنقل بين الشرائح
                if (absDiffX > absDiffY) {
                    if (diffX > 50 && currentSlide > 0) {
                        // سحب لليمين - الشريحة السابقة
                        goToSlide(currentSlide - 1);
                    } else if (diffX < -50 && currentSlide < images.length - 1) {
                        // سحب لليسار - الشريحة التالية
                        goToSlide(currentSlide + 1);
                    }
                }
            }
            
            // نقل صورة لأعلى في الترتيب
            function moveImageUp(index) {
                if (index <= 0) return;
                
                // تبديل المواقع في المصفوفة
                [images[index], images[index - 1]] = [images[index - 1], images[index]];
                
                // حفظ وعرض التغييرات
                saveImages();
                renderSlides();
                goToSlide(index - 1);
                
                showNotification('تم نقل الصورة للأعلى');
            }
            
            // نقل صورة لأسفل في الترتيب
            function moveImageDown(index) {
                if (index >= images.length - 1) return;
                
                // تبديل المواقع في المصفوفة
                [images[index], images[index + 1]] = [images[index + 1], images[index]];
                
                // حفظ وعرض التغييرات
                saveImages();
                renderSlides();
                goToSlide(index + 1);
                
                showNotification('تم نقل الصورة للأسفل');
            }
            
            // دعم إسقاط الملفات
            sliderContainer.addEventListener('dragover', function(e) {
                e.preventDefault();
                sliderContainer.style.backgroundColor = 'rgba(255, 255, 255, 0.1)';
            });
            
            sliderContainer.addEventListener('dragleave', function() {
                sliderContainer.style.backgroundColor = '';
            });
            
            sliderContainer.addEventListener('drop', function(e) {
                e.preventDefault();
                sliderContainer.style.backgroundColor = '';
                
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    processFiles(files);
                }
            });
            
            // تهيئة أولية
            renderSlides();
        });
    </script>
</body>
</html>
